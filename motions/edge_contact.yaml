scope:
  # definition of some nice short-cuts
  - unit_x: {vector3: [1, 0, 0]}
  - unit_y: {vector3: [0, 1, 0]}
  - unit_z: {vector3: [0, 0, 1]}
  
  # definition of joint input variables
  - torso_lift_joint: {input-var: 0}
  - l_shoulder_pan_joint: {input-var: 1}
  - l_shoulder_lift_joint: {input-var: 2}
  - l_upper_arm_roll_joint: {input-var: 3}
  - l_elbow_flex_joint: {input-var: 4}
  - l_forearm_roll_joint: {input-var: 5}
  - l_wrist_flex_joint: {input-var: 6}
  - l_wrist_roll_joint: {input-var: 7}
  - r_shoulder_pan_joint: {input-var: 8}
  - r_shoulder_lift_joint: {input-var: 9}
  - r_upper_arm_roll_joint: {input-var: 10}
  - r_elbow_flex_joint: {input-var: 11}
  - r_forearm_roll_joint: {input-var: 12}
  - r_wrist_flex_joint: {input-var: 13}
  - r_wrist_roll_joint: {input-var: 14}
  
  # definition of joint transforms
  - torso_lift:
      frame: [{axis-angle: [unit_x, 0]}, {vector3: [-0.05, 0, {double-add: [0.739675, torso_lift_joint]}]}]
  - l_shoulder_pan:
      frame: [{axis-angle: [unit_z, l_shoulder_pan_joint]}, {vector3: [0.0, 0.188, 0.0]}]
  - l_shoulder_lift:
      frame: [{axis-angle: [unit_y, l_shoulder_lift_joint]}, {vector3: [0.1, 0, 0]}]
  - l_upper_arm_roll:
      frame: [{axis-angle: [unit_x, l_upper_arm_roll_joint]}, {vector3: [0, 0, 0]}]
  - l_elbow_flex:
      frame: [{axis-angle: [unit_y, l_elbow_flex_joint]}, {vector3: [0.4, 0, 0]}]
  - l_forearm_roll:
      frame: [{axis-angle: [unit_x, l_forearm_roll_joint]}, {vector3: [0, 0, 0]}]
  - l_wrist_flex:
      frame: [{axis-angle: [unit_y, l_wrist_flex_joint]}, {vector3: [0.321, 0, 0]}]
  - l_wrist_roll:
      frame: [{axis-angle: [unit_x, l_wrist_roll_joint]}, {vector3: [0, 0, 0]}]
  - l_gripper_offset:
      frame: [{axis-angle: [unit_x, 0]}, {vector3: [0.2156, 0, 0]}]
  - r_shoulder_pan:
      frame: [{axis-angle: [unit_z, r_shoulder_pan_joint]}, {vector3: [0, -0.188, 0]}]
  - r_shoulder_lift:
      frame: [{axis-angle: [unit_y, r_shoulder_lift_joint]}, {vector3: [0.1, 0, 0]}]
  - r_upper_arm_roll: 
      frame: [{axis-angle: [unit_x, r_upper_arm_roll_joint]}, {vector3: [0, 0, 0]}]
  - r_elbow_flex:
      frame: [{axis-angle: [unit_y, r_elbow_flex_joint]}, {vector3: [0.4, 0, 0]}]
  - r_forearm_roll:
      frame: [{axis-angle: [unit_x, r_forearm_roll_joint]}, {vector3: [0, 0, 0]}]
  - r_wrist_flex:
      frame: [{axis-angle: [unit_y, r_wrist_flex_joint]}, {vector3: [0.321, 0, 0]}]
  - r_wrist_roll:
      frame: [{axis-angle: [unit_x, r_wrist_roll_joint]}, {vector3: [0, 0, 0]}]
  - r_gripper_offset:
      frame: [{axis-angle: [unit_x, 0]}, {vector3: [0.18, 0, 0]}]

  # definition of elbow FK
  - left_elbow:
      frame-mul:
      - torso_lift
      - l_shoulder_pan
      - l_shoulder_lift
      - l_upper_arm_roll
      - l_elbow_flex
  - right_elbow:
      frame-mul:
      - torso_lift
      - r_shoulder_pan
      - r_shoulder_lift
      - r_upper_arm_roll
      - r_elbow_flex

  # defintion of EE FK
  - left_ee:
      frame-mul:
      - left_elbow
      - l_forearm_roll
      - l_wrist_flex
      - l_wrist_roll
      - l_gripper_offset
  - right_ee:
      frame-mul:
      - right_elbow
      - r_forearm_roll
      - r_wrist_flex
      - r_wrist_roll
      - r_gripper_offset
      
  # control params
  - pos_p_gain: 3.0
  - rot_p_gain: 3.0
  - pos_thresh: 0.05
  - rot_thresh: 0.1
  - weight_arm_joints: 0.001
  - weight_torso_joint: 0.01
  - weight_pos_control: 1
  - weight_rot_control: 1
  - weight_elbow_control: 0
  - l_neg_vel_limit_arm_joints: -0.6
  - l_pos_vel_limit_arm_joints: 0.6
  - r_neg_vel_limit_arm_joints: 0
  - r_pos_vel_limit_arm_joints: 0
  - neg_vel_limit_torso_joint: -0.02
  - pos_vel_limit_torso_joint: 0.02
  
  # some constants
  - controllable-weight: 0.001 # mu * 1
  - constraint-weight: 10.001 # mu + 10
  
  # definition of object frames 
  - gripper-frame:
      left_ee
  - utility-frame:
     frame-mul:
       - right_ee  
       - frame:
          - quaternion: [-0.171777970707, -0.685860866607, -0.0174027448572, 0.706954273563]
          - vector3: [0.06, 0.11, 0]
  - tool-gripper-frame:
      frame:
        - quaternion: [-0.0500550264148, 0.705614610626, 0.700932017793, -0.0910868927763] # x, y, z, w
        - vector3: [0.14, 0.028, -0.02] # x, y, z

  # definition of features
  - tool-point: 
      transform-vector:
        - frame-mul: [gripper-frame, tool-gripper-frame]
        - {vector3: [-0.028, 0.002, 0.01]}       
  - utility-point: {transform-vector: [utility-frame, {vector3: [0.0, 0.14, 0.044]}]}

  # expressions used in constraints 
  - distance: {vector-sub: [utility-point, tool-point]}
  
  - l_goal_rot: 
      rotation-mul: 
        - {axis-angle: [unit_z, 0]}
        - {axis-angle: [unit_y, 0]}
        - {axis-angle: [unit_x, 0]}
  - l_rot: {orientation-of: left_ee}
  - l_rot_error: {vector-norm: {rot-vector: {rotation-mul: [{inverse-rotation: l_rot}, l_goal_rot]}}}
  - l_rot_scaling: 
      double-if:
      - {double-sub: [rot_thresh, l_rot_error]}
      - 1
      - {double-div: [rot_thresh, l_rot_error]}
  - l_intermediate_goal_rot:
      slerp:
      - l_rot
      - l_goal_rot
      - l_rot_scaling
  - l_rot_control:
      scale-vector: [rot_p_gain, {rotate-vector: [l_rot, {rot-vector: {rotation-mul: [{inverse-rotation: l_rot}, l_intermediate_goal_rot]}}]}]

controllable-constraints:
  # torso joint
  - controllable-constraint: [neg_vel_limit_torso_joint, pos_vel_limit_torso_joint, weight_torso_joint, 0, torso_lift_joint]
  # left arm joints
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 1, l_shoulder_pan_joint]
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 2, l_shoulder_lift_joint]
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 3, l_upper_arm_roll_joint]
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 4, l_elbow_flex_joint]
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 5, l_forearm_roll_joint]
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 6, l_wrist_flex_joint]
  - controllable-constraint: [l_neg_vel_limit_arm_joints, l_pos_vel_limit_arm_joints, weight_arm_joints, 7, l_wrist_roll_joint]
  # right arm joints
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 8, r_shoulder_pan_joint]
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 9, r_shoulder_lift_joint]
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 10, r_upper_arm_roll_joint]
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 11, r_elbow_flex_joint]
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 12, r_forearm_roll_joint]
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 13, r_wrist_flex_joint]
  - controllable-constraint: [r_neg_vel_limit_arm_joints, r_pos_vel_limit_arm_joints, weight_arm_joints, 14, r_wrist_roll_joint]

soft-constraints: 
  - soft-constraint: 
      - {double-sub: [-0.007, {x-coord: distance}]} # control law for lower boundary
      - {double-sub: [0.007, {x-coord: distance}]} # control law for upper boundary
      - constraint-weight # weight of this constraint
      - {x-coord: distance} # expression used for Jacobian calcuation
      - contact_x # name of expression reported
  - soft-constraint: 
      - {double-sub: [-0.007, {y-coord: distance}]} # control law for lower boundary
      - {double-sub: [0.007, {y-coord: distance}]} # control law for upper boundary
      - constraint-weight # weight of this constraint
      - {y-coord: distance} # expression used for Jacobian calcuation
      - contact_y # name of expression reported
  - soft-constraint: 
      - {double-sub: [-0.007, {z-coord: distance}]} # control law for lower boundary
      - {double-sub: [0.007, {z-coord: distance}]} # control law for upper boundary
      - constraint-weight # weight of this constraint
      - {z-coord: distance} # expression used for Jacobian calcuation
      - contact_z # name of expression reported
  - soft-constraint: [{x-coord: l_rot_control}, {x-coord: l_rot_control}, weight_rot_control, {x-coord: {rot-vector: l_rot}}, left EE x-rot control slack]
  - soft-constraint: [{y-coord: l_rot_control}, {y-coord: l_rot_control}, weight_rot_control, {y-coord: {rot-vector: l_rot}}, left EE y-rot control slack]
  - soft-constraint: [{z-coord: l_rot_control}, {z-coord: l_rot_control}, weight_rot_control, {z-coord: {rot-vector: l_rot}}, left EE z-rot control slack]

hard-constraints:
  - hard-constraint:
      - {double-sub: [0.0115, torso_lift_joint]}
      - {double-sub: [0.325, torso_lift_joint]}
      - torso_lift_joint
  - hard-constraint:
      - {double-sub: [-0.5646, l_shoulder_pan_joint]}
      - {double-sub: [2.1353, l_shoulder_pan_joint]}
      - l_shoulder_pan_joint
  - hard-constraint:
      - {double-sub: [-0.3536, l_shoulder_lift_joint]}
      - {double-sub: [1.2963, l_shoulder_lift_joint]}
      -  l_shoulder_lift_joint
  - hard-constraint:
      - {double-sub: [-0.65, l_upper_arm_roll_joint]}
      - {double-sub: [3.75, l_upper_arm_roll_joint]}
      - l_upper_arm_roll_joint
  - hard-constraint:
      - {double-sub: [-2.1213, l_elbow_flex_joint]}
      - {double-sub: [-0.15, l_elbow_flex_joint]}
      - l_elbow_flex_joint
  - hard-constraint:
      - {double-sub: [-2.0, l_wrist_flex_joint]}
      - {double-sub: [-0.1, l_wrist_flex_joint]}
      - l_wrist_flex_joint
  - hard-constraint:
      - {double-sub: [-2.1353, r_shoulder_pan_joint]}
      - {double-sub: [0.5646, r_shoulder_pan_joint]}
      - r_shoulder_pan_joint
  - hard-constraint:
      - {double-sub: [-0.3536, r_shoulder_lift_joint]}
      - {double-sub: [1.2963, r_shoulder_lift_joint]}
      -  r_shoulder_lift_joint
  - hard-constraint:
      - {double-sub: [-3.75, r_upper_arm_roll_joint]}
      - {double-sub: [0.65, r_upper_arm_roll_joint]}
      - r_upper_arm_roll_joint
  - hard-constraint:
      - {double-sub: [-2.1213, r_elbow_flex_joint]}
      - {double-sub: [-0.15, r_elbow_flex_joint]}
      - r_elbow_flex_joint
  - hard-constraint:
      - {double-sub: [-2.0, r_wrist_flex_joint]}
      - {double-sub: [-0.1, r_wrist_flex_joint]}
      - r_wrist_flex_joint

